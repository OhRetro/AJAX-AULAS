<!DOCTYPE html>
<html>
    <head>
        <meta charset='UTF-8'>
        <title>Petshop: Clientes</title>
        <link rel='stylesheet' href='css/estilo.css'>
    </head>

    <body class="conteudo exercicio">
        <h1>Petshop: Clientes</h1>

        <script>
            function ajax(config) {
                const xhr = new XMLHttpRequest()
                xhr.open(config.method, config.url, true)

                xhr.onload = e => {
                    if (xhr.status === 200) {
                        config.success(xhr.response)
                    } else if (xhr.status >= 400) {
                        config.error({
                            code: xhr.status,
                            text: xhr.statusText
                        })
                    }
                }

                xhr.send()
            }

            function createTables(response) {
                const keys = Object.keys(response[0])

                const table = document.createElement("table")
                const thead = document.createElement("thead")
                const trHead = document.createElement("tr")

                keys.forEach(key => {
                    const th = document.createElement("th");
                    const headerText = key.replace("_", " ").toUpperCase()
                    th.innerHTML = headerText
                    trHead.appendChild(th)
                })

                thead.appendChild(trHead)
                table.appendChild(thead)

                const tbody = document.createElement("tbody")

                response.forEach(obj => {
                    const tr = document.createElement("tr")

                    keys.forEach(key => {
                        const td = document.createElement("td")
                        td.innerHTML = obj[key]
                        tr.appendChild(td)
                    })

                    tbody.appendChild(tr)
                })

                table.appendChild(tbody)

                document.body.appendChild(table)
            }


            ajax({
                url: "/dados/petshop_clientes.json",
                method: "GET",
                success: (res) => {
                    const response = JSON.parse(res)
                    createTables(response);
                },
                error: (err) => {
                    const msg = document.createTextNode(`${err.code}: ${err.text}`)
                    document.body.appendChild(msg)
                }
            })
        </script>
    </body>
</html>